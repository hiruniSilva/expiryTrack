let express,validateToken,models;_e31‍.x([["default",()=>_e31‍.o]]);_e31‍.w("express",[["default",["express"],function(v){express=v}]]);_e31‍.w("../middleware/auth",[["validateToken",["validateToken"],function(v){validateToken=v}]]);_e31‍.w("../models",[["default",["models"],function(v){models=v}]]);



const router = express.Router();

router.get('/all', async(req,res) => {
    try{
        const users = await models.User.findAll({include: { all: true }});
        res.status(200).json(users.map(user=>user.toUserJson()));
    }catch(error){
        res.status(400).send(error.message);
    }
})

router.post('/addUser', async(req,res) => {
    try{
        const{fullname, email, password, roles } = req.body;

        const isValid = models.User.validateUserData({
			fullname,
			email,
			password,
			roles,
		});
        if (!isValid) throw new Error("Invalid Data");
        const user = await models.User.create({
			fullname,
			email,
			roles,
			passwordHash: await models.User.hashPassword(password),
		});
    }catch(error){
        res.status(400).send(error.message);
    }
})

router.get("/current", validateToken, async(req,res) => {
    const user = await models.User.findOne({
        where: {
            id: req.user.id
        }
    });
    res.send(user? user.toUserJson(): null)
});

_e31‍.d(router);